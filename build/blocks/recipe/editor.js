(()=>{"use strict";const e=window.wp.blocks,t=window.wp.i18n,r=window.wp.data,i=window.wp.date,s=window.wp.components,a=window.wp.blockEditor,n=window.wp.element,c=window.ReactJSXRuntime;function l(e){const r=e.props,i=e.keyName,l=e.label,o=e.className;return(0,c.jsx)(a.MediaUploadCheck,{children:(0,c.jsx)(a.MediaUpload,{onSelect:e=>{if(e){const t={};t[i]=e.url,t[i+"Id"]=e.id,r.setAttributes(t)}},allowedTypes:["image"],value:r.attributes[i],render:({open:e})=>(0,c.jsxs)(n.Fragment,{children:[(0,c.jsx)("div",{className:"image-preview image-preview-"+o,style:{backgroundImage:"url("+r.attributes[i]+")"},onClick:e,children:r.attributes[i]?"":(0,c.jsx)("span",{className:"aspect-ratio",children:l})}),r.attributes[i]?(0,c.jsxs)(n.Fragment,{children:[(0,c.jsx)(s.Button,{isSecondary:"true",onClick:e,children:(0,t.__)("Change image","recipe-creator")}),(0,c.jsx)(s.Button,{onClick:()=>{const e={};e[i]=null,e[i+"Id"]=null,r.setAttributes(e)},children:(0,t.__)("Remove image","recipe-creator")})]}):(0,c.jsx)(s.Button,{isSecondary:"true",onClick:e,children:(0,t.__)("Select image","recipe-creator")})]})})})}function o({props:e}){const r=[{value:"servings",label:(0,t.__)("servings","recipe-creator")},{value:"piece",label:(0,t.__)("piece","recipe-creator")},{value:"springform-pan",label:(0,t.__)("springform pan","recipe-creator")},{value:"square-baking-pan",label:(0,t.__)("square baking pan","recipe-creator")},{value:"baking-tray",label:(0,t.__)("baking tray","recipe-creator")}];return(0,c.jsxs)(c.Fragment,{children:[-1!==["square-baking-pan"].indexOf(e.attributes.recipeYieldUnit)?(0,c.jsxs)("div",{className:"square-baking-pans-x-wrapper",children:[(0,c.jsx)(s.__experimentalInputControl,{label:(0,t.__)("Results in","recipe-creator"),type:"number",min:"0",value:e.attributes.recipeYieldWidth,placeholder:"0",onChange:t=>{e.setAttributes({recipeYield:0,recipeYieldWidth:t})},suffix:(0,t.__)("cm","recipe-creator")}),(0,c.jsx)("span",{className:"square-baking-pans-x",children:"x"}),(0,c.jsx)(s.__experimentalInputControl,{label:"",type:"number",min:"0",value:e.attributes.recipeYieldHeight,placeholder:"0",onChange:t=>{e.setAttributes({recipeYield:0,recipeYieldHeight:t})},suffix:(0,t.__)("cm","recipe-creator")})]}):(0,c.jsx)(s.__experimentalInputControl,{label:(0,t.__)("Results in","recipe-creator"),type:"number",min:"0",value:e.attributes.recipeYield,placeholder:"0",onChange:t=>{e.setAttributes({recipeYield:t,recipeYieldWidth:0,recipeYieldHeight:0})},suffix:"springform-pan"===e.attributes.recipeYieldUnit?(0,t.__)("cm","recipe-creator"):""}),(0,c.jsx)(s.SelectControl,{label:(0,t.__)("Unit","recipe-creator"),value:e.attributes.recipeYieldUnit,options:r,onChange:t=>e.setAttributes({recipeYieldUnit:t})})]})}const p=window.lodash;function d({list:e,onChange:t,placeholder:r,tagName:i="ul"}){const s=(0,n.useRef)([]),[l,o]=(0,n.useState)(0);(0,n.useEffect)((()=>{0===e.length&&t([""])}),[]);const d=i;return(0,c.jsx)(d,{children:(e||[""]).map(((i,n)=>(0,c.jsx)("li",{children:(0,c.jsx)(a.RichText,{disableLineBreaks:!0,value:i||"",placeholder:r,__unstablePastePlainText:!0,onChange:r=>{const i=(0,p.cloneDeep)(e);i[n]=r,t(i)},onKeyUp:r=>{if("Enter"===r.key){!function(r){const i=(0,p.cloneDeep)(e);i.splice(r+1,0,""),t(i)}(n);const r=window.getSelection().getRangeAt(0);if(r.endOffset<r.endContainer.length){const i=r.endContainer.textContent,s=i.substring(0,r.endOffset),a=i.substring(r.endOffset),c=(0,p.cloneDeep)(e);c[n]=s,c.length>=n+1?c.splice(n+1,0,a):c.push(a),t(c)}window.setTimeout((()=>{const e=n+1;s.current[e]&&s.current[e].focus()}),0)}if("Backspace"===r.key&&""===i)if(l>0){!function(r){if(void 0!==e[r]){const i=(0,p.cloneDeep)(e);i.splice(r,1),t(i)}}(n);const r=n-1;if(r<s.current.length){const e=s.current[r];e.focus();const t=document.createRange(),i=window.getSelection();t.setStart(e,e.childNodes.length),t.collapse(!0),i.removeAllRanges(),i.addRange(t)}}else o(l+1);"Backspace"!==r.key&&o(0)},ref:e=>s.current[n]=e})})))})}function u({props:e}){return(0,c.jsxs)(c.Fragment,{children:[e.attributes.preparationStepsGroups.map(((r,i)=>(0,c.jsxs)("div",{className:"recipe-creator--recipe-block--editor",children:[0!==i||e.attributes.preparationStepsGroups.length>1?(0,c.jsxs)("div",{className:"recipe-creator--recipe-block--group-header",children:[(0,c.jsx)(a.RichText,{tagName:"h3",value:r.title||"",placeholder:(0,t.__)("Group name","recipe-creator"),__unstablePastePlainText:!0,onChange:t=>{const s={...r,title:t},a=(0,p.cloneDeep)(e.attributes.preparationStepsGroups);a[i]=s,e.setAttributes({preparationStepsGroups:a})}}),(0,c.jsx)(s.Button,{variant:"tertiary",onClick:()=>function(r){if(e.attributes.preparationStepsGroups[r]&&confirm((0,t.__)("Are you shure you want to delete this group? All steps will be deleted.","recipe-creator"))){const t=(0,p.cloneDeep)(e.attributes.preparationStepsGroups);t.splice(r,1),0===t.length?t.push({title:"",list:""}):1===t.length&&(t[0].title=""),e.setAttributes({preparationStepsGroups:t})}return!1}(i),children:(0,t.__)("Remove Group","recipe-creator")})]}):"",(0,c.jsx)(d,{tagName:"ol",list:r.list,onChange:t=>{const r=(0,p.cloneDeep)(e.attributes.preparationStepsGroups);r[i].list=t,e.setAttributes({preparationStepsGroups:r})},placeholder:(0,t.__)("Add the steps of preparation here...","recipe-creator")})]},"preparationStepsGroups_"+i))),(0,c.jsx)(s.Button,{variant:"secondary",onClick:function(){const t=[...e.attributes.preparationStepsGroups,{title:"",list:""}];return e.setAttributes({preparationStepsGroups:t}),!1},children:1===e.attributes.preparationStepsGroups.length?(0,t.__)("Split steps into groups","recipe-creator"):(0,t.__)("Add additional group","recipe-creator")})]})}function h({props:e}){return(0,c.jsxs)(c.Fragment,{children:[e.attributes.ingredientsGroups.map(((r,i)=>(0,c.jsxs)("div",{className:"recipe-creator--recipe-block--editor",children:[0!==i||e.attributes.ingredientsGroups.length>1?(0,c.jsxs)("div",{className:"recipe-creator--recipe-block--group-header",children:[(0,c.jsx)(a.RichText,{tagName:"h3",value:r.title||"",placeholder:(0,t.__)("Group name","recipe-creator"),__unstablePastePlainText:!0,onChange:t=>{const s={...r,title:t},a=(0,p.cloneDeep)(e.attributes.ingredientsGroups);a[i]=s,e.setAttributes({ingredientsGroups:a})}}),(0,c.jsx)(s.Button,{variant:"tertiary",onClick:()=>function(r){if(e.attributes.ingredientsGroups[r]&&confirm((0,t.__)("Are you shure you want to delete this group? All ingredients will be deleted.","recipe-creator"))){const t=(0,p.cloneDeep)(e.attributes.ingredientsGroups);t.splice(r,1),0===t.length?t.push({title:"",list:[""]}):1===t.length&&(t[0].title=""),e.setAttributes({ingredientsGroups:t})}return!1}(i),children:(0,t.__)("Remove Group","recipe-creator")})]}):"",(0,c.jsx)(d,{list:r.list,onChange:t=>{const r=(0,p.cloneDeep)(e.attributes.ingredientsGroups);r[i].list=t,e.setAttributes({ingredientsGroups:r})},placeholder:(0,t.__)("Add the ingredients here...","recipe-creator")})]},"ingredientsGroups_"+i))),(0,c.jsx)(s.Button,{variant:"secondary",onClick:function(){const t=[...e.attributes.ingredientsGroups,{title:"",list:[""]}];return e.setAttributes({ingredientsGroups:t}),!1},children:1===e.attributes.ingredientsGroups.length?(0,t.__)("Split ingredients into groups","recipe-creator"):(0,t.__)("Add additional group","recipe-creator")})]})}const m=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":2,"name":"recipe-creator/recipe","title":"Recipe","description":"Add a recipe and optimize it easily for search engines.","category":"formatting","icon":"carrot","textdomain":"recipe-creator","supports":{"html":false,"align":["center","wide","full"]},"attributes":{"utensils":{"type":"array","default":[""]},"ingredientsGroups":{"type":"array","default":[{"title":"","list":[""]}]},"preparationStepsGroups":{"type":"array","default":[{"title":"","list":[""]}]},"name":{"type":"string","default":""},"description":{"type":"string","default":""},"difficulty":{"type":"string"},"notes":{"type":"string","default":""},"prepTime":{"type":"string","default":""},"restTime":{"type":"string","default":""},"cookTime":{"type":"string","default":""},"bakingTime":{"type":"string","default":""},"totalTime":{"type":"string","default":""},"recipeYield":{"type":"string","default":"0"},"recipeYieldWidth":{"type":"string","default":"0"},"recipeYieldHeight":{"type":"string","default":"0"},"recipeYieldUnit":{"type":"string","default":"servings"},"videoIframeUrl":{"type":"string","default":""},"calories":{"type":"string","default":""},"recipeCuisine":{"type":"string","default":""},"image1_1":{"type":"string","default":""},"image1_1Id":{"type":"number"},"image3_2":{"type":"string","default":""},"image3_2Id":{"type":"number"},"image4_3":{"type":"string","default":""},"image4_3Id":{"type":"number"},"image16_9":{"type":"string","default":""},"image16_9Id":{"type":"number"},"pinterestImageId":{"type":"number"},"pinterestImageUrl":{"type":"string","default":""},"videoUrl":{"type":"string","default":""},"content":{"type":"string","default":""},"className":{"type":"string","default":""},"align":{"type":"string","default":"center"}},"editorScript":"file:editor.js","editorStyle":"file:editor.css","viewScript":"file:view.js","style":"file:view.css"}');(0,e.registerBlockType)(m,{title:(0,t.__)("Recipe","recipe-creator"),description:(0,t.__)("Add a recipe and optimize it easily for search engines.","recipe-creator"),edit:(0,r.withSelect)((e=>({data:{site:e("core").getSite()||{},publishDate:(0,i.format)("d.m.Y",wp.data.select("core/editor").getEditedPostAttribute("date")),meta:e("core/editor").getEditedPostAttribute("meta")}})))((function(e){(0,n.useEffect)((()=>{e.attributes.ingredients&&e.setAttributes({ingredients:null,ingredientsGroups:[{title:"",list:e.attributes.ingredients}]}),e.attributes.preparationSteps&&e.setAttributes({preparationSteps:null,preparationStepsGroups:[{title:"",list:e.attributes.preparationSteps}]})}),[]);const{editPost:i}=(0,r.useDispatch)("core/editor"),p=["image"];function m(t,r,i={}){let s=parseInt(e.attributes.prepTime,10)||0,a=parseInt(e.attributes.restTime,10)||0,n=parseInt(e.attributes.cookTime,10)||0,c=parseInt(e.attributes.bakingTime,10)||0;const l=parseInt(r,10);if(!isNaN(l)){switch(t){case"prepTime":s=l,i.prepTime=""+s;break;case"restTime":a=l,i.restTime=""+a;break;case"cookTime":n=l,i.cookTime=""+n;break;case"bakingTime":c=l,i.bakingTime=""+c}i.totalTime=""+(s+a+n+c),e.setAttributes(i)}}return(0,c.jsxs)(n.Fragment,{children:[(0,c.jsxs)(a.InspectorControls,{children:[(0,c.jsx)(s.PanelBody,{title:(0,t.__)("Pinterest","recipe-creator"),className:"recipe-creator--sidebar",children:(0,c.jsx)(s.PanelRow,{children:(0,c.jsx)(a.MediaUploadCheck,{children:(0,c.jsx)(a.MediaUpload,{onSelect:t=>{t&&e.setAttributes({pinterestImageId:t.id,pinterestImageUrl:t.url})},allowedTypes:p,value:e.attributes.pinterestImageUrl,render:({open:r})=>(0,c.jsxs)(n.Fragment,{children:[(0,c.jsx)("img",{src:e.attributes.pinterestImageUrl,onClick:r}),(0,c.jsx)("button",{type:"button",className:"components-button is-secondary",onClick:r,children:(0,t.__)("Select image","recipe-creator")})]})})})})}),(0,c.jsxs)(s.PanelBody,{title:(0,t.__)("SEO","recipe-creator"),className:"recipe-creator--sidebar",children:[(0,c.jsx)(s.PanelRow,{children:(0,c.jsx)("p",{children:(0,t.__)("Google and other search engines need more information to present your recipe in the best possible way. You should provide this information as good as possible.","recipe-creator")})}),(0,c.jsx)(s.PanelRow,{children:(0,c.jsx)(s.TextControl,{label:(0,t.__)("Cuisine","recipe-creator"),value:e.attributes.recipeCuisine,placeholder:(0,t.__)('e.g. "Italian" or "German"',"recipe-creator"),onChange:t=>{e.setAttributes({recipeCuisine:t})}})}),(0,c.jsx)("hr",{}),(0,c.jsxs)(s.PanelRow,{children:[(0,c.jsx)("h4",{children:(0,t.__)("Picture of the finished dish","recipe-creator")}),(0,c.jsxs)("p",{children:[(0,t.__)("Depending on the usage Google uses different image formats of your recipe. You can find more information","recipe-creator")," ",(0,c.jsx)("a",{href:(0,t.__)("https://recipe-creator.de/mehr-klicks-durch-optimierte-rezeptbilder","recipe-creator"),target:"_blank",children:(0,t.__)("here","recipe-creator")}),"."]})]}),(0,c.jsx)(s.PanelRow,{children:(0,c.jsx)(l,{props:e,keyName:"image16_9",label:"16:9",className:"16-9"})}),(0,c.jsx)("hr",{}),(0,c.jsx)(s.PanelRow,{children:(0,c.jsx)(l,{props:e,keyName:"image3_2",label:"3:2",className:"3-2"})}),(0,c.jsx)("hr",{}),(0,c.jsx)(s.PanelRow,{children:(0,c.jsx)(l,{props:e,keyName:"image4_3",label:"4:3",className:"4-3"})}),(0,c.jsx)("hr",{}),(0,c.jsx)(s.PanelRow,{children:(0,c.jsx)(l,{props:e,keyName:"image1_1",label:"1:1",className:"1-1"})})]})]}),(0,c.jsx)("div",{...(0,a.useBlockProps)(),children:(0,c.jsxs)("div",{className:"wp-block recipe-creator recipe-creator--block recipe-creator--recipe-block",children:[(0,c.jsx)(a.BlockControls,{}),(0,c.jsxs)("div",{className:"recipe-creator--block--inner",children:[(0,c.jsx)("div",{className:"recipe-creator--recipe-block--title",children:(0,c.jsx)(a.RichText,{tagName:"h2",value:e.attributes.name,__unstablePastePlainText:!0,placeholder:(0,t.__)("Title of your recipe","recipe-creator"),onChange:t=>{e.setAttributes({name:t})}})}),(0,c.jsxs)("div",{className:"recipe-creator--recipe-block--intro",children:[(0,c.jsxs)("div",{className:"recipe-creator--recipe-block--difficulty--selector",children:[(0,c.jsx)("span",{className:"recipe-creator--recipe-block--difficulty"+("simple"!==e.attributes.difficulty?" unselected":""),onClick:()=>{e.setAttributes({difficulty:"simple"})},children:(0,t.__)("simple","recipe-creator")}),(0,c.jsx)("span",{className:"recipe-creator--recipe-block--difficulty"+("moderate"!==e.attributes.difficulty?" unselected":""),onClick:()=>{e.setAttributes({difficulty:"moderate"})},children:(0,t.__)("moderate","recipe-creator")}),(0,c.jsx)("span",{className:"recipe-creator--recipe-block--difficulty"+("challenging"!==e.attributes.difficulty?" unselected":""),onClick:()=>{e.setAttributes({difficulty:"challenging"})},children:(0,t.__)("challenging","recipe-creator")})]}),(0,c.jsx)(a.RichText,{tagName:"p",value:e.attributes.description,placeholder:(0,t.__)("Short description of your recipe","recipe-creator"),__unstablePastePlainText:!0,onChange:t=>{e.setAttributes({description:t})}})]}),(0,c.jsx)("div",{className:"recipe-creator--recipe-block--thumbnail",style:{backgroundImage:e.attributes.image3_2?"url("+e.attributes.image3_2+")":""},children:(0,c.jsx)(a.MediaUploadCheck,{children:(0,c.jsx)(a.MediaUpload,{onSelect:t=>{t&&e.setAttributes({image3_2:t.url,image3_2Id:t.id})},allowedTypes:p,value:e.attributes.image3_2,render:({open:t})=>(0,c.jsx)("div",{className:"recipe-creator--recipe-block--thumbnail-spacer"+(e.attributes.image3_2?"":" recipe-creator--empty"),onClick:t})})})}),(0,c.jsx)("div",{className:"recipe-creator--recipe-block--timings",children:(0,c.jsxs)("ul",{children:[(0,c.jsxs)("li",{children:[(0,c.jsxs)("header",{children:[(0,t.__)("Prep time","recipe-creator"),":"]}),(0,c.jsx)("span",{children:(0,c.jsx)(s.__experimentalInputControl,{type:"number",min:"0",value:e.attributes.prepTime,placeholder:"0",onChange:e=>{m("prepTime",e)},suffix:(0,t.__)("Min.","recipe-creator")})})]}),(0,c.jsxs)("li",{children:[(0,c.jsxs)("header",{children:[(0,t.__)("Rest time","recipe-creator"),":"]}),(0,c.jsx)("span",{children:(0,c.jsx)(s.__experimentalInputControl,{type:"number",min:"0",value:e.attributes.restTime,placeholder:"0",onChange:e=>{m("restTime",e)},suffix:(0,t.__)("Min.","recipe-creator")})})]}),(0,c.jsxs)("li",{children:[(0,c.jsxs)("header",{children:[(0,t.__)("Cook time","recipe-creator"),":"]}),(0,c.jsx)("span",{children:(0,c.jsx)(s.__experimentalInputControl,{type:"number",min:"0",value:e.attributes.cookTime,placeholder:"0",onChange:e=>{m("cookTime",e)},suffix:(0,t.__)("Min.","recipe-creator")})})]}),(0,c.jsxs)("li",{children:[(0,c.jsxs)("header",{children:[(0,t.__)("Baking time","recipe-creator"),":"]}),(0,c.jsx)("span",{children:(0,c.jsx)(s.__experimentalInputControl,{type:"number",min:"0",value:e.attributes.bakingTime,placeholder:"0",onChange:e=>{m("bakingTime",e)},suffix:(0,t.__)("Min.","recipe-creator")})})]}),(0,c.jsxs)("li",{children:[(0,c.jsxs)("header",{children:[(0,t.__)("Total time","recipe-creator"),":"]}),(0,c.jsxs)("span",{children:[e.attributes.totalTime||"0"," ",(0,t.__)("Min.","recipe-creator")]})]})]})}),(0,c.jsxs)("section",{className:"recipe-creator--recipe-block--ingredients",children:[(0,c.jsx)("div",{className:"recipe-creator--recipe-block--headline",children:(0,c.jsx)("h3",{children:(0,t.__)("Ingredients","recipe-creator")})}),(0,c.jsx)("div",{className:"recipe-creator--recipe-block--flex-container",children:(0,c.jsx)(o,{props:e})}),(0,c.jsx)(h,{props:e})]}),(0,c.jsxs)("section",{className:"recipe-creator--recipe-block--utensils",children:[(0,c.jsx)("div",{className:"recipe-creator--recipe-block--headline",children:(0,c.jsx)("h3",{children:(0,t.__)("Utensils","recipe-creator")})}),(0,c.jsx)(d,{list:e.attributes.utensils,onChange:t=>{e.setAttributes({utensils:t})},placeholder:(0,t.__)("Add the needed utensils here...","recipe-creator")})]}),(0,c.jsxs)("div",{className:"recipe-creator--recipe-block--preparation-steps",children:[(0,c.jsx)("div",{className:"recipe-creator--recipe-block--headline",children:(0,c.jsx)("h3",{children:(0,t.__)("Steps of preparation","recipe-creator")})}),(0,c.jsx)(u,{props:e})]}),(0,c.jsxs)("section",{className:"recipe-creator--recipe-block--video",children:[(0,c.jsx)("div",{className:"recipe-creator--recipe-block--headline",children:(0,c.jsx)("h3",{children:(0,t.__)("Video","recipe-creator")})}),(0,c.jsx)("div",{className:"recipe-creator--recipe-block--flex-container",children:(0,c.jsx)(s.TextControl,{label:(0,t.__)("YouTube or Vimeo link","recipe-creator"),value:e.attributes.videoUrl,onChange:t=>{if(t){const r=function(e){const t=function(e){if(e){const t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/);if(t&&11===t[2].length)return t[2]}return null}(e);if(t)return(r=t)?"//www.youtube-nocookie.com/embed/"+r:null;{const t=function(e){if(e){const t=e.match(/(?:vimeo)\.com.*(?:videos|video|channels|)\/([\d]+)/i);if(t&&t[1])return t[1]}return null}(e);if(t)return function(e){return e?"//player.vimeo.com/video/"+e:null}(t)}var r;return null}(t);r?e.setAttributes({videoUrl:t,videoIframeUrl:r}):e.setAttributes({videoUrl:t,videoIframeUrl:null})}}})})]}),(0,c.jsxs)("section",{className:"recipe-creator--recipe-block--notes",children:[(0,c.jsx)("div",{className:"recipe-creator--recipe-block--headline",children:(0,c.jsx)("h3",{children:(0,t.__)("Notes","recipe-creator")})}),(0,c.jsx)(a.RichText,{tagName:"p",value:e.attributes.notes,placeholder:(0,t.__)("Additional notes ...","recipe-creator"),__unstablePastePlainText:!0,onChange:t=>{e.setAttributes({notes:t})}})]})]})]})}),(0,r.select)("core/edit-post").isEditorSidebarOpened()?null:(0,c.jsx)("button",{type:"button",className:"components-button is-tertiary recipe-creator--show-additional-settings",onClick:()=>{(0,r.dispatch)("core/edit-post").openGeneralSidebar("edit-post/document")},children:(0,t.__)("Show additional settings","recipe-creator")})]})})),save:e=>e})})();